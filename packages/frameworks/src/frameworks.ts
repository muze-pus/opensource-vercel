import { join } from 'path';
import { promises } from 'fs';

import { Framework } from './types';
import { readConfigFile } from './read-config-file';

export * from './types';

const { readdir, stat, readFile, unlink } = promises;
const isDir = async (file: string): Promise<boolean> =>
  (await stat(file)).isDirectory();

/**
 * Please note that is extremely important that the `dependency` property needs
 * to reference a CLI. This is needed because you might want (for example) a
 * Gatsby site that is powered by Preact, so you can't look for the `preact`
 * dependency.  Instead, you need to look for `preact-cli` when optimizing Preact
 * CLI projects.
 */

export const frameworks = [
  {
    name: 'Blitz.js',
    slug: 'blitzjs',
    demo: 'https://blitzjs.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/blitz.svg',
    tagline: 'Blitz.js: The Fullstack React Framework',
    description:
      'A brand new Blitz.js app - the result of running `npx blitz new`.',
    website: 'https://blitzjs.com',
    useRuntime: { src: 'package.json', use: '@vercel/next' },
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"blitz":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `blitz build`',
      },
      devCommand: {
        value: 'blitz start',
      },
      outputDirectory: {
        placeholder: 'Next.js default',
      },
    },
    devCommand: 'blitz start',
    buildCommand: 'blitz build',
    getOutputDirName: async () => 'public',
  },
  {
    name: 'Next.js',
    slug: 'nextjs',
    demo: 'https://nextjs.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/next.svg',
    tagline:
      'Next.js makes you productive with React instantly â€” whether you want to build static or dynamic sites.',
    description: 'A Next.js app and a Serverless Function API.',
    website: 'https://nextjs.org',
    sort: 1,
    useRuntime: { src: 'package.json', use: '@vercel/next' },
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"next":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `next build`',
      },
      devCommand: {
        value: 'next dev --port $PORT',
      },
      outputDirectory: {
        placeholder: 'Next.js default',
      },
    },
    recommendedIntegrations: [
      {
        id: 'oac_5lUsiANun1DEzgLg0NZx5Es3',
        dependencies: ['next-plugin-sentry', 'next-sentry-source-maps'],
      },
    ],
    devCommand: 'next dev --port $PORT',
    buildCommand: 'next build',
    getOutputDirName: async () => 'public',
  },
  {
    name: 'Gatsby.js',
    slug: 'gatsby',
    demo: 'https://gatsby.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/gatsby.svg',
    tagline:
      'Gatsby helps developers build blazing fast websites and apps with React.',
    description:
      'A Gatsby app, using the default starter theme and a Serverless Function API.',
    website: 'https://gatsbyjs.org',
    sort: 2,
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"gatsby":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `gatsby build`',
      },
      devCommand: {
        value: 'gatsby develop --port $PORT',
      },
      outputDirectory: {
        value: 'public',
      },
    },
    dependency: 'gatsby',
    devCommand: 'gatsby develop --port $PORT',
    buildCommand: 'gatsby build',
    getOutputDirName: async () => 'public',
    defaultRoutes: async (dirPrefix: string) => {
      // This file could be generated by gatsby-plugin-now or gatsby-plugin-zeit-now
      try {
        const nowRoutesPath = join(
          dirPrefix,
          'public',
          '__now_routes_g4t5bY.json'
        );
        const content = await readFile(nowRoutesPath, 'utf8');
        const nowRoutes = JSON.parse(content);
        try {
          await unlink(nowRoutesPath);
        } catch (err) {
          // do nothing if deleting the file fails
        }
        return nowRoutes;
      } catch (err) {
        // if the file doesn't exist, we implement gatsby's recommendations
        // https://www.gatsbyjs.org/docs/caching

        return [
          {
            src: '^/static/(.*)$',
            headers: { 'cache-control': 'public,max-age=31536000,immutable' },
            continue: true,
          },
          {
            src: '^/.*\\.(js|css)$',
            headers: { 'cache-control': 'public,max-age=31536000,immutable' },
            continue: true,
          },
          {
            src: '^/(sw\\.js|app-data\\.json|.*\\.html|page-data/.*)$',
            headers: { 'cache-control': 'public,max-age=0,must-revalidate' },
            continue: true,
          },
          {
            handle: 'filesystem',
          },
          {
            src: '.*',
            status: 404,
            dest: '404.html',
          },
        ];
      }
    },
    cachePattern: '{.cache,public}/**',
  },
  {
    name: 'Hexo',
    slug: 'hexo',
    demo: 'https://hexo.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/hexo.svg',
    tagline:
      'Hexo is a fast, simple & powerful blog framework powered by Node.js.',
    description: 'A Hexo site, created with the Hexo CLI.',
    website: 'https://hexo.io',
    sort: 3,
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"hexo":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `hexo generate`',
      },
      devCommand: {
        value: 'hexo server --port $PORT',
      },
      outputDirectory: {
        value: 'public',
      },
    },
    dependency: 'hexo',
    devCommand: 'hexo server --port $PORT',
    buildCommand: 'hexo generate',
    getOutputDirName: async () => 'public',
  },
  {
    name: 'Eleventy',
    slug: 'eleventy',
    demo: 'https://eleventy.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/eleventy.svg',
    tagline:
      '11ty is a simpler static site generator written in JavaScript, created to be an alternative to Jekyll.',
    description: 'An Eleventy site, created with npm init.',
    website: 'https://www.11ty.dev',
    sort: 4,
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"@11ty\\/eleventy":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `npx @11ty/eleventy`',
      },
      devCommand: {
        value: 'npx @11ty/eleventy --serve --watch --port $PORT',
      },
      outputDirectory: {
        value: '_site',
      },
    },
    dependency: '@11ty/eleventy',
    devCommand: 'npx @11ty/eleventy --serve --watch --port $PORT',
    buildCommand: 'npx @11ty/eleventy',
    getOutputDirName: async () => '_site',
    cachePattern: '.cache/**',
  },
  {
    name: 'Docusaurus 2',
    slug: 'docusaurus-2',
    demo: 'https://docusaurus-2.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/docusaurus.svg',
    tagline:
      'Docusaurus makes it easy to maintain Open Source documentation websites.',
    description:
      'A static Docusaurus site that makes it easy to maintain OSS documentation.',
    website: 'https://v2.docusaurus.io',
    detectors: {
      some: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"@docusaurus\\/core":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `docusaurus build`',
      },
      devCommand: {
        value: 'docusaurus start --port $PORT',
      },
      outputDirectory: {
        value: 'build',
      },
    },
    dependency: '@docusaurus/core',
    devCommand: 'docusaurus start --port $PORT',
    buildCommand: 'docusaurus build',
    getOutputDirName: async (dirPrefix: string) => {
      const base = 'build';
      try {
        const location = join(dirPrefix, base);
        const content = await readdir(location);

        // If there is only one file in it that is a dir we'll use it as dist dir
        if (content.length === 1 && (await isDir(join(location, content[0])))) {
          return join(base, content[0]);
        }
      } catch (error) {
        console.error(`Error detecting output directory: `, error);
      }

      return base;
    },
    defaultRoutes: [
      {
        src: '^/[^./]+\\.[0-9a-f]{8}\\.(css|js)$',
        headers: { 'cache-control': 'max-age=31536000, immutable' },
        continue: true,
      },
      {
        src:
          '^/assets/images/[^/]+-[0-9a-f]{32}\\.(ico|svg|jpg|jpeg|png|gif|webp)$',
        headers: { 'cache-control': 'max-age=31536000, immutable' },
        continue: true,
      },
      {
        src:
          '^/assets/medias/[^/]+-[0-9a-f]{32}\\.(ogv|wav|mp3|m4a|aac|oga|flac)$',
        headers: { 'cache-control': 'max-age=31536000, immutable' },
        continue: true,
      },
      {
        src:
          '^/assets/files/[^/]+-[0-9a-f]{32}\\.(pdf|doc|docx|xls|xlsx|zip|rar)$',
        headers: { 'cache-control': 'max-age=31536000, immutable' },
        continue: true,
      },
      {
        src: '^/ideal-img/[^/]+\\.[0-9a-f]{7}\\.\\d+\\.(png|jpe?g|gif)$',
        headers: { 'cache-control': 'max-age=31536000, immutable' },
        continue: true,
      },
      {
        handle: 'filesystem',
      },
      {
        src: '.*',
        status: 404,
        dest: '404.html',
      },
    ],
  },
  {
    name: 'Docusaurus 1',
    slug: 'docusaurus',
    demo: 'https://docusaurus.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/docusaurus.svg',
    tagline:
      'Docusaurus makes it easy to maintain Open Source documentation websites.',
    description:
      'A static Docusaurus site that makes it easy to maintain OSS documentation.',
    website: 'https://docusaurus.io/',
    detectors: {
      some: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"docusaurus":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `docusaurus-build`',
      },
      devCommand: {
        value: 'docusaurus-start --port $PORT',
      },
      outputDirectory: {
        value: 'build',
      },
    },
    dependency: 'docusaurus',
    devCommand: 'docusaurus-start --port $PORT',
    buildCommand: 'docusaurus-build',
    getOutputDirName: async (dirPrefix: string) => {
      const base = 'build';
      try {
        const location = join(dirPrefix, base);
        const content = await readdir(location);

        // If there is only one file in it that is a dir we'll use it as dist dir
        if (content.length === 1 && (await isDir(join(location, content[0])))) {
          return join(base, content[0]);
        }
      } catch (error) {
        console.error(`Error detecting output directory: `, error);
      }
      return base;
    },
  },
  {
    name: 'Preact',
    slug: 'preact',
    demo: 'https://preact.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/preact.svg',
    tagline:
      'Preact is a fast 3kB alternative to React with the same modern API.',
    description: 'A Preact app, created with the Preact CLI.',
    website: 'https://preactjs.com',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"preact-cli":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `preact build`',
      },
      devCommand: {
        value: 'preact watch --port $PORT',
      },
      outputDirectory: {
        value: 'build',
      },
    },
    dependency: 'preact-cli',
    devCommand: 'preact watch --port $PORT',
    buildCommand: 'preact build',
    getOutputDirName: async () => 'build',
    defaultRoutes: [
      {
        handle: 'filesystem',
      },
      {
        src: '/(.*)',
        dest: '/index.html',
      },
    ],
  },
  {
    name: 'Dojo',
    slug: 'dojo',
    demo: 'https://dojo.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/dojo.png',
    tagline: 'Dojo is a modern progressive, TypeScript first framework.',
    description:
      "A Dojo app, created with the Dojo CLI's cli-create-app command.",
    website: 'https://dojo.io',
    detectors: {
      some: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"@dojo\\/framework":\\s*".+?"[^}]*}',
        },
        {
          path: '.dojorc',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `dojo build`',
      },
      devCommand: {
        value: 'dojo build -m dev -w -s -p $PORT',
      },
      outputDirectory: {
        value: 'output/dist',
      },
    },
    dependency: '@dojo/cli',
    devCommand: 'dojo build -m dev -w -s -p $PORT',
    buildCommand: 'dojo build',
    getOutputDirName: async () => join('output', 'dist'),
    defaultRoutes: [
      {
        handle: 'filesystem',
      },
      {
        src: '/service-worker.js',
        headers: { 'cache-control': 's-maxage=0' },
        continue: true,
      },
      {
        src: '/(.*)',
        dest: '/index.html',
      },
    ],
  },
  {
    name: 'Ember.js',
    slug: 'ember',
    demo: 'https://ember.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/ember.svg',
    tagline:
      'Ember.js helps webapp developers be more productive out of the box.',
    description: 'An Ember app, created with the Ember CLI.',
    website: 'https://emberjs.com/',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"ember-cli":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `ember build`',
      },
      devCommand: {
        value: 'ember serve --port $PORT',
      },
      outputDirectory: {
        value: 'dist',
      },
    },
    dependency: 'ember-cli',
    devCommand: 'ember serve --port $PORT',
    buildCommand: 'ember build',
    getOutputDirName: async () => 'dist',
    defaultRoutes: [
      {
        handle: 'filesystem',
      },
      {
        src: '/(.*)',
        dest: '/index.html',
      },
    ],
  },
  {
    name: 'Vue.js',
    slug: 'vue',
    demo: 'https://vue.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/vue.svg',
    tagline:
      'Vue.js is a versatile JavaScript framework that is as approachable as it is performant.',
    description: 'A Vue.js app, created with the Vue CLI.',
    website: 'https://vuejs.org',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"@vue\\/cli-service":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `vue-cli-service build`',
      },
      devCommand: {
        value: 'vue-cli-service serve --port $PORT',
      },
      outputDirectory: {
        value: 'dist',
      },
    },
    dependency: '@vue/cli-service',
    devCommand: 'vue-cli-service serve --port $PORT',
    buildCommand: 'vue-cli-service build',
    getOutputDirName: async () => 'dist',
    defaultRoutes: [
      {
        src: '^/[^/]*\\.(js|txt|ico|json)',
        headers: { 'cache-control': 'max-age=300' },
        continue: true,
      },
      {
        src: '^/(img|js|css|fonts|media)/[^/]+\\.[0-9a-f]{8}\\.*',
        headers: { 'cache-control': 'max-age=31536000, immutable' },
        continue: true,
      },
      {
        handle: 'filesystem',
      },
      {
        src: '^.*',
        dest: '/index.html',
      },
    ],
  },
  {
    name: 'Scully',
    slug: 'scully',
    demo: 'https://scully.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/scullyio-logo.png',
    tagline: 'Scully is a static site generator for Angular.',
    description: 'The Static Site Generator for Angular apps.',
    website: 'https://github.com/scullyio/scully',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"@scullyio\\/init":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `ng build && scully`',
      },
      devCommand: {
        value: 'ng serve --port $PORT',
      },
      outputDirectory: {
        value: 'dist',
      },
    },
    dependency: '@scullyio/init',
    devCommand: 'ng serve --port $PORT',
    buildCommand: 'ng build && scully',
    getOutputDirName: async () => 'dist/static',
  },
  {
    name: 'Ionic Angular',
    slug: 'ionic-angular',
    demo: 'https://ionic-angular.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/ionic.svg',
    tagline:
      'Ionic Angular allows you to build mobile PWAs with Angular and the Ionic Framework.',
    description: 'An Ionic Angular site, created with the Ionic CLI.',
    website: 'https://ionicframework.com',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"@ionic\\/angular":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `ng build`',
      },
      devCommand: {
        value: 'ng start',
      },
      outputDirectory: {
        value: 'www',
      },
    },
    dependency: '@ionic/angular',
    devCommand: 'ng start',
    buildCommand: 'ng build',
    getOutputDirName: async () => 'www',
    defaultRoutes: [
      {
        handle: 'filesystem',
      },
      {
        src: '/(.*)',
        dest: '/index.html',
      },
    ],
  },
  {
    name: 'Angular',
    slug: 'angular',
    demo: 'https://angular.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/angular.svg',
    tagline:
      'Angular is a TypeScript-based cross-platform framework from Google.',
    description: 'An Angular app, created with the Angular CLI.',
    website: 'https://angular.io',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"@angular\\/cli":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `ng build`',
      },
      devCommand: {
        value: 'ng serve --port $PORT',
      },
      outputDirectory: {
        value: 'dist',
      },
    },
    dependency: '@angular/cli',
    devCommand: 'ng serve --port $PORT',
    buildCommand: 'ng build',
    getOutputDirName: async (dirPrefix: string) => {
      const base = 'dist';
      try {
        const location = join(dirPrefix, base);
        const content = await readdir(location);

        // If there is only one file in it that is a dir we'll use it as dist dir
        if (content.length === 1 && (await isDir(join(location, content[0])))) {
          return join(base, content[0]);
        }
      } catch (error) {
        console.error(`Error detecting output directory: `, error);
      }
      return base;
    },
    defaultRoutes: [
      {
        handle: 'filesystem',
      },
      {
        src: '/(.*)',
        dest: '/index.html',
      },
    ],
  },
  {
    name: 'Polymer',
    slug: 'polymer',
    demo: 'https://polymer.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/polymer.svg',
    tagline:
      'Polymer is an open-source webapps library from Google, for building using Web Components.',
    description: 'A Polymer app, created with the Polymer CLI.',
    website: 'https://www.polymer-project.org/',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"polymer-cli":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `polymer build`',
      },
      devCommand: {
        value: 'polymer serve --port $PORT',
      },
      outputDirectory: {
        value: 'build',
      },
    },
    dependency: 'polymer-cli',
    devCommand: 'polymer serve --port $PORT',
    buildCommand: 'polymer build',
    getOutputDirName: async (dirPrefix: string) => {
      const base = 'build';
      try {
        const location = join(dirPrefix, base);
        const content = await readdir(location);
        const paths = content.filter(item => !item.includes('.'));
        return join(base, paths[0]);
      } catch (error) {
        console.error(`Error detecting output directory: `, error);
      }
      return base;
    },
    defaultRoutes: [
      {
        handle: 'filesystem',
      },
      {
        src: '/(.*)',
        dest: '/index.html',
      },
    ],
  },
  {
    name: 'Svelte',
    slug: 'svelte',
    demo: 'https://svelte.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/svelte.svg',
    tagline:
      'Svelte lets you write high performance reactive apps with significantly less boilerplate. ',
    description:
      'A Svelte app, using the Svelte template, and a Serverless Function API.',
    website: 'https://svelte.dev',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"sirv-cli":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `rollup -c`',
      },
      devCommand: {
        value: 'sirv public --single --dev --port $PORT',
      },
      outputDirectory: {
        value: 'public',
      },
    },
    dependency: 'sirv-cli',
    devCommand: 'sirv public --single --dev --port $PORT',
    buildCommand: 'rollup -c',
    getOutputDirName: async () => 'public',
    defaultRoutes: [
      {
        handle: 'filesystem',
      },
      {
        src: '/(.*)',
        dest: '/index.html',
      },
    ],
  },
  {
    name: 'Ionic React',
    slug: 'ionic-react',
    demo: 'https://ionic-react.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/ionic.svg',
    tagline:
      'Ionic React allows you to build mobile PWAs with React and the Ionic Framework.',
    description: 'An Ionic React site, created with the Ionic CLI.',
    website: 'https://ionicframework.com',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"@ionic\\/react":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `react-scripts build`',
      },
      devCommand: {
        value: 'react-scripts start',
      },
      outputDirectory: {
        value: 'build',
      },
    },
    dependency: '@ionic/react',
    devCommand: 'react-scripts start',
    buildCommand: 'react-scripts build',
    getOutputDirName: async () => 'build',
    defaultRoutes: [
      {
        src: '/static/(.*)',
        headers: { 'cache-control': 's-maxage=31536000, immutable' },
        continue: true,
      },
      {
        src: '/service-worker.js',
        headers: { 'cache-control': 's-maxage=0' },
        continue: true,
      },
      {
        src: '/sockjs-node/(.*)',
        dest: '/sockjs-node/$1',
      },
      {
        handle: 'filesystem',
      },
      {
        src: '/(.*)',
        headers: { 'cache-control': 's-maxage=0' },
        dest: '/index.html',
      },
    ],
  },
  {
    name: 'Create React App',
    slug: 'create-react-app',
    demo: 'https://react-functions.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/react.svg',
    tagline: 'Create React App allows you to get going with React in no time.',
    description:
      'A React app, bootstrapped with create-react-app, and a Serverless Function API.',
    website: 'https://create-react-app.dev',
    detectors: {
      some: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"react-scripts":\\s*".+?"[^}]*}',
        },
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"react-dev-utils":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `react-scripts build`',
      },
      devCommand: {
        value: 'react-scripts start',
      },
      outputDirectory: {
        value: 'build',
      },
    },
    dependency: 'react-scripts',
    devCommand: 'react-scripts start',
    buildCommand: 'react-scripts build',
    getOutputDirName: async () => 'build',
    defaultRoutes: [
      {
        src: '/static/(.*)',
        headers: { 'cache-control': 's-maxage=31536000, immutable' },
        continue: true,
      },
      {
        src: '/service-worker.js',
        headers: { 'cache-control': 's-maxage=0' },
        continue: true,
      },
      {
        src: '/sockjs-node/(.*)',
        dest: '/sockjs-node/$1',
      },
      {
        handle: 'filesystem',
      },
      {
        src: '/(.*)',
        headers: { 'cache-control': 's-maxage=0' },
        dest: '/index.html',
      },
    ],
  },
  {
    name: 'Gridsome',
    slug: 'gridsome',
    demo: 'https://gridsome.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/gridsome.svg',
    tagline:
      'Gridsome is a Vue.js-powered framework for building websites & apps that are fast by default.',
    description: 'A Gridsome app, created with the Gridsome CLI.',
    website: 'https://gridsome.org/',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"gridsome":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `gridsome build`',
      },
      devCommand: {
        value: 'gridsome develop -p $PORT',
      },
      outputDirectory: {
        value: 'dist',
      },
    },
    dependency: 'gridsome',
    devCommand: 'gridsome develop -p $PORT',
    buildCommand: 'gridsome build',
    getOutputDirName: async () => 'dist',
  },
  {
    name: 'UmiJS',
    slug: 'umijs',
    demo: 'https://umijs.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/umi.svg',
    tagline:
      'UmiJS is an extensible enterprise-level React application framework.',
    description: 'An UmiJS app, created using the Umi CLI.',
    website: 'https://umijs.org',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"umi":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `umi build`',
      },
      devCommand: {
        value: 'umi dev --port $PORT',
      },
      outputDirectory: {
        value: 'dist',
      },
    },
    dependency: 'umi',
    devCommand: 'umi dev --port $PORT',
    buildCommand: 'umi build',
    getOutputDirName: async () => 'dist',
    defaultRoutes: [
      {
        handle: 'filesystem',
      },
      {
        src: '/(.*)',
        dest: '/index.html',
      },
    ],
  },
  {
    name: 'Sapper',
    slug: 'sapper',
    demo: 'https://sapper.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/svelte.svg',
    tagline:
      'Sapper is a framework for building high-performance universal web apps with Svelte.',
    description: 'A Sapper app, using the Sapper template.',
    website: 'https://sapper.svelte.dev',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"sapper":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `sapper export`',
      },
      devCommand: {
        value: 'sapper dev --port $PORT',
      },
      outputDirectory: {
        value: '__sapper__/export',
      },
    },
    dependency: 'sapper',
    devCommand: 'sapper dev --port $PORT',
    buildCommand: 'sapper export',
    getOutputDirName: async () => '__sapper__/export',
  },
  {
    name: 'Saber',
    slug: 'saber',
    demo: 'https://saber.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/saber.svg',
    tagline:
      'Saber is a framework for building static sites in Vue.js that supports data from any source.',
    description: 'A Saber site, created with npm init.',
    website: 'https://saber.land/',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"saber":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `saber build`',
      },
      devCommand: {
        value: 'saber --port $PORT',
      },
      outputDirectory: {
        value: 'public',
      },
    },
    dependency: 'saber',
    devCommand: 'saber --port $PORT',
    buildCommand: 'saber build',
    getOutputDirName: async () => 'public',
    defaultRoutes: [
      {
        src: '/_saber/.*',
        headers: { 'cache-control': 'max-age=31536000, immutable' },
      },
      {
        handle: 'filesystem',
      },
      {
        src: '.*',
        status: 404,
        dest: '404.html',
      },
    ],
  },
  {
    name: 'Stencil',
    slug: 'stencil',
    demo: 'https://stencil.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/stencil.svg',
    tagline:
      'Stencil is a powerful toolchain for building Progressive Web Apps and Design Systems.',
    description: 'A Stencil site, created with the Stencil CLI.',
    website: 'https://stenciljs.com/',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"@stencil\\/core":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `stencil build`',
      },
      devCommand: {
        value: 'stencil build --dev --watch --serve --port $PORT',
      },
      outputDirectory: {
        value: 'www',
      },
    },
    dependency: '@stencil/core',
    devCommand: 'stencil build --dev --watch --serve --port $PORT',
    buildCommand: 'stencil build',
    getOutputDirName: async () => 'www',
    defaultRoutes: [
      {
        src: '/assets/(.*)',
        headers: { 'cache-control': 'max-age=2592000' },
        continue: true,
      },
      {
        src: '/build/p-.*',
        headers: { 'cache-control': 'max-age=31536000, immutable' },
        continue: true,
      },
      {
        src: '/sw.js',
        headers: { 'cache-control': 'no-cache' },
        continue: true,
      },
      {
        handle: 'filesystem',
      },
      {
        src: '/(.*)',
        dest: '/index.html',
      },
    ],
  },
  {
    name: 'Nuxt.js',
    slug: 'nuxtjs',
    demo: 'https://nuxtjs.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/nuxt.svg',
    tagline:
      'Nuxt.js is the web comprehensive framework that lets you dream big with Vue.js.',
    description: 'A Nuxt.js app, bootstrapped with create-nuxt-app.',
    website: 'https://nuxtjs.org',
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"nuxt(-edge)?":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `nuxt generate`',
      },
      devCommand: {
        value: 'nuxt',
      },
      outputDirectory: {
        value: 'dist',
      },
    },
    dependency: 'nuxt',
    devCommand: 'nuxt',
    buildCommand: 'nuxt generate',
    getOutputDirName: async () => 'dist',
    cachePattern: '.nuxt/**',
    defaultRoutes: [
      {
        src: '/sw.js',
        headers: { 'cache-control': 'no-cache' },
        continue: true,
      },
      {
        src: '/_nuxt/(.*)',
        headers: { 'cache-control': 'public,max-age=31536000,immutable' },
        continue: true,
      },
      {
        handle: 'filesystem',
      },
      {
        src: '/(.*)',
        dest: '/200.html',
      },
    ],
  },
  {
    name: 'RedwoodJS',
    slug: 'redwoodjs',
    demo: 'https://redwoodjs.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/redwoodjs.svg',
    tagline: 'RedwoodJS is a full-stack framework for the Jamstack.',
    description: 'A RedwoodJS app, bootstraped with create-redwood-app.',
    website: 'https://redwoodjs.com',
    useRuntime: { src: 'package.json', use: '@vercel/redwood' },
    ignoreRuntimes: ['@vercel/node'],
    detectors: {
      every: [
        {
          path: 'package.json',
          matchContent:
            '"(dev)?(d|D)ependencies":\\s*{[^}]*"@redwoodjs\\/core":\\s*".+?"[^}]*}',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        value:
          'yarn rw build && yarn rw db up --no-db-client --auto-approve && yarn rw dataMigrate up',
      },
      devCommand: {
        value: 'yarn rw dev --fwd="--port=$PORT --open=false"',
      },
      outputDirectory: {
        placeholder: 'RedwoodJS default',
      },
    },
    devCommand: 'yarn rw dev --fwd="--port=$PORT --open=false',
    buildCommand:
      'yarn rw build && yarn rw db up --no-db-client --auto-approve && yarn rw dataMigrate up',
    getOutputDirName: async () => 'public',
  },
  {
    name: 'Hugo',
    slug: 'hugo',
    demo: 'https://hugo.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/hugo.svg',
    tagline:
      'Hugo is the worldâ€™s fastest framework for building websites, written in Go.',
    description: 'A Hugo site, created with the Hugo CLI.',
    website: 'https://gohugo.io',
    sort: 5,
    detectors: {
      some: [
        {
          path: 'config.yaml',
        },
        {
          path: 'config.toml',
        },
        {
          path: 'config.json',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: 'None',
      },
      buildCommand: {
        placeholder: '`npm run build` or `hugo -D --gc`',
      },
      devCommand: {
        value: 'hugo server -D -w -p $PORT',
      },
      outputDirectory: {
        placeholder: '`public` or `publishDir` from the `config` file',
      },
    },
    devCommand: 'hugo server -D -w -p $PORT',
    buildCommand: 'hugo -D --gc',
    getOutputDirName: async (dirPrefix: string): Promise<string> => {
      type HugoConfig = { publishDir?: string };
      const config = await readConfigFile<HugoConfig>(
        ['config.json', 'config.yaml', 'config.toml'].map(fileName => {
          return join(dirPrefix, fileName);
        })
      );

      return (config && config.publishDir) || 'public';
    },
    defaultVersion: '0.58.2',
  },
  {
    name: 'Jekyll',
    slug: 'jekyll',
    demo: 'https://jekyll.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/jekyll.svg',
    tagline:
      'Jekyll makes it super easy to transform your plain text into static websites and blogs.',
    description: 'A Jekyll site, created with the Jekyll CLI.',
    website: 'https://jekyllrb.com/',
    detectors: {
      every: [
        {
          path: '_config.yml',
        },
      ],
    },
    settings: {
      installCommand: {
        value: 'bundle install',
      },
      buildCommand: {
        placeholder: '`npm run build` or `jekyll build`',
      },
      devCommand: {
        value: 'bundle exec jekyll serve --watch --port $PORT',
      },
      outputDirectory: {
        placeholder: '`_site` or `destination` from `_config.yml`',
      },
    },
    devCommand: 'bundle exec jekyll serve --watch --port $PORT',
    buildCommand: 'jekyll build',
    getOutputDirName: async (dirPrefix: string): Promise<string> => {
      type JekyllConfig = { destination?: string };
      const config = await readConfigFile<JekyllConfig>(
        join(dirPrefix, '_config.yml')
      );
      return (config && config.destination) || '_site';
    },
  },
  {
    name: 'Brunch',
    slug: 'brunch',
    demo: 'https://brunch.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/brunch.svg',
    tagline:
      'Brunch is a fast and simple webapp build tool with seamless incremental compilation for rapid development.',
    description: 'A Brunch app, created with the Brunch CLI.',
    website: 'https://brunch.io/',
    detectors: {
      every: [
        {
          path: 'brunch-config.js',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run build` or `brunch build --production`',
      },
      devCommand: {
        value: 'brunch watch --server --port $PORT',
      },
      outputDirectory: {
        value: 'public',
      },
    },
    devCommand: 'brunch watch --server --port $PORT',
    buildCommand: 'brunch build --production',
    getOutputDirName: async () => 'public',
  },
  {
    name: 'Middleman',
    slug: 'middleman',
    demo: 'https://middleman.now-examples.now.sh',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/middleman.svg',
    tagline:
      'Middleman is a static site generator that uses all the shortcuts and tools in modern web development.',
    description: 'A Middleman app, created with the Middleman CLI.',
    website: 'https://middlemanapp.com/',
    detectors: {
      every: [
        {
          path: 'config.rb',
        },
      ],
    },
    settings: {
      installCommand: {
        value: 'bundle install',
      },
      buildCommand: {
        value: '`npm run build` or `bundle exec middleman build`',
      },
      devCommand: {
        value: 'bundle exec middleman server -p $PORT',
      },
      outputDirectory: {
        value: 'build',
      },
    },
    devCommand: 'bundle exec middleman server -p $PORT',
    buildCommand: 'bundle exec middleman build',
    getOutputDirName: async () => 'build',
  },
  {
    name: 'Zola',
    slug: 'zola',
    demo: 'https://zola.now-examples.vercel.app',
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/zola.png',
    tagline: 'Everything you need to make a static site engine in one binary.',
    description: 'A Zola app, created with the "Getting Started" tutorial.',
    website: 'https://www.getzola.org',
    detectors: {
      every: [
        {
          path: 'config.toml',
          matchContent: 'base_url',
        },
      ],
    },
    settings: {
      installCommand: {
        placeholder: 'None',
      },
      buildCommand: {
        value: 'zola build',
      },
      devCommand: {
        value: 'zola serve --port $PORT',
      },
      outputDirectory: {
        value: 'public',
      },
    },
    devCommand: 'zola serve --port $PORT',
    buildCommand: 'zola build',
    getOutputDirName: async () => 'public',
    defaultVersion: '0.13.0',
  },
  {
    name: 'Other',
    slug: null,
    logo:
      'https://raw.githubusercontent.com/vercel/vercel/master/packages/frameworks/logos/other.svg',
    description: 'No framework or a unoptimized framework.',
    settings: {
      installCommand: {
        placeholder: '`yarn install` or `npm install`',
      },
      buildCommand: {
        placeholder: '`npm run vercel-build` or `npm run build`',
      },
      devCommand: {
        placeholder: 'None',
      },
      outputDirectory: {
        placeholder: '`public` if it exists, or `.`',
      },
    },
    devCommand: null,
    buildCommand: null,
    getOutputDirName: async () => 'public',
  },
] as const;

const def = frameworks as readonly Framework[];
export default def;
